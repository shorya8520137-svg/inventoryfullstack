# Run these commands directly on the server:

# 1. Clean up files
rm -f test-*.js debug-*.js check-*.js fix-*.js analyze-*.js setup-*.* backup-*.* *.html *.sql *.md *.txt *.ps1 run-*.* deploy-*.* push-*.* verify-*.js comprehensive-*.js automated-*.js master-*.cmd ssh-*.cmd git-*.* mirror-*.cmd UPLOAD_AND_START.cmd server-https.js server-integration-code.js server-test-*.js quick-*.js simple-*.js manual-*.js notification-*.js EventAuditLogger.js ProductionEventAuditLogger.js IPGeolocationTracker.js AuditLogger.js

# 2. Setup nginx
sudo tee /etc/nginx/sites-available/default > /dev/null << 'EOF'
server {
    listen 80 default_server;
    listen [::]:80 default_server;
    server_name _;
    location / {
        proxy_pass http://localhost:5000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
EOF

# 3. Restart nginx
sudo systemctl restart nginx

# 4. Kill existing node processes
pkill -f 'node' 2>/dev/null || true

# 5. Start server
cd ~/inventoryfullstack
nohup node server.js > server.log 2>&1 &

# 6. Test
sleep 3
curl -s http://localhost:5000 | head -3
curl -s http://localhost | head -3

echo "Done! Server should be at http://13.212.182.78.nip.io"